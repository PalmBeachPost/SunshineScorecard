(function(){var $jsi={'chartbeat_proxypoint_name':'premium-chartbeat-top-widget','free_div_id':'#cm-popular-container','free_site_domain':'mypalmbeachpost.com','chartbeat_number_of_stories':3,};var rule_attribute_map={'PA':'path','TI':'i'},rule_operator_map={'CO':function(s,x){return s.indexOf(x)!==-1;},'SW':function(s,x){return s.indexOf(x)===0;},'EW':function(s,x){return s.indexOf(x,s.length-x.length)!==-1;},'EQ':function(s,x){return s===x;}};function htmlEncode(s)
{var el=document.createElement("div");el.innerText=el.textContent=s;s=el.innerHTML;s=s.replace(/'/g,"&#39;").replace(/-/g,"&#45;");return s;}
function unblacklist(pages,blacklistRules){blacklistRules=blacklistRules||[];return pages.filter(function(page){return!blacklistRules.some(function(rule){var operator=rule_operator_map[rule.operator]||function(){return false;};var attribute=page[rule_attribute_map[rule.attribute]];var attributeLower=attribute&&attribute.toLowerCase();var valueLower=rule.value&&rule.value.toLowerCase();var special_char_index=page.i.indexOf('&#');if(special_char_index!=-1){valueLower=htmlEncode(valueLower);}
var blacklisted=attributeLower&&valueLower&&operator(attributeLower,valueLower);if(blacklisted&&window.console){console.log('Trending now page excluded: '+JSON.stringify(page));}
return blacklisted;});});};function ChartbeatTrending($){var $div_id,$most_read=$('.cm-most-read'),number_of_trending_containers=$most_read.find(' > div[id^="cm-most-read"]').length;function cleanDomain(domain){return domain.replace(/^https?:\/\//i,'').replace(/\s*/g,'').replace(/^(www\.)/i,'').replace(/\/.*/g,'').replace(/[^0-9A-Za-z\.-]*/g,'');}
return{limit:3,mobileDifferentDomain:true,Callback:function(data){var display_limit=cmg.utility.chartbeat_trending.limit||3;$.ajax({url:'/analytics/blacklist-rules/',dataType:'json'}).done(function(bl_rules){data=unblacklist(data,bl_rules);cmg.utility.chartbeat_trending.Render(data.slice(0,display_limit));}).fail(function(){cmg.utility.chartbeat_trending.Render(data.slice(0,display_limit));});},Render:function(data){var that=this;var $list_item=cmg._.template($('#cm-most-read-item-template').html());if(data.length){$(data).each(function(x,story){if(story.path.indexOf($jsi.premium_site_domain)>-1){$div_id=$($jsi.premium_div_id);}else{$div_id=$($jsi.free_div_id);if(story.path.indexOf('/')===0){story.path=$jsi.free_site_domain+story.path;}}
$div_id.append($list_item({story_index:x+1,story_link:'http://'+encodeURI(story.path)+'?ref=cbTopWidget',story_headline:story.i}));});if(typeof cmg.site_meta.is_mobile!="undefined"){if(cmg.site_meta.is_mobile){cmg.query('.cm-social-share-btn-most-read').off().on('click',cmg.socialShare.onClickFunction);}}}else{$div_id.append($list_item({story_index:'',story_link:'#',story_headline:'Currently no pages listed.'}));if(typeof cmg.site_meta.is_mobile!="undefined"){if(cmg.site_meta.is_mobile){$div_id.find(".cm-list-key").each(function(i,ldiv){$(ldiv).html("");});$div_id.find(".cm-social-share-btn-most-read").each(function(i,button){$(button).hide();});}}}},Init:function(div_id,endpoint,domain,limit){var domain=cleanDomain(domain||location.host),req_limit=6;if(limit){req_limit=limit*2;cmg.utility.chartbeat_trending.limit=limit;}
if(endpoint){$div_id=$(div_id);$div_id.addClass('initialized');if(this.mobileDifferentDomain&&typeof cmg.site_meta.is_mobile!="undefined"){if(cmg.site_meta.is_mobile){domain="m."+domain;}}
$.ajax({url:'http://'+location.host+'/api/proxyapi/'+endpoint+'/',type:'GET',data:{host:domain,limit:req_limit,jsonp:'cmg.utility.chartbeat_trending.Callback'},crossdomain:true,cache:true,timeout:3000,error:function(jqXHR,status,error){if(number_of_trending_containers>1){$div_id.hide();}else{$most_read.hide();}
throw'There was an error ('+error+') fetching the data from chartbeat.';}});}else{if(number_of_trending_containers>1){$div_id.hide();}else{$most_read.hide();}}}}}
cmg.utility.chartbeat_trending=ChartbeatTrending(cmg.query);cmg.query(document).on('ready',function($){if(!cmg.query($jsi.free_div_id).hasClass('initialized')){if(!$jsi.chartbeat_proxypoint_name){$jsi.chartbeat_proxypoint_name='chartbeat-top-widget';}
cmg.utility.chartbeat_trending.Init($jsi.free_div_id,$jsi.chartbeat_proxypoint_name,$jsi.free_site_domain,$jsi.chartbeat_number_of_stories);}
if($jsi.premium_div_id){cmg.utility.chartbeat_trending.Init($jsi.premium_div_id,'premium-chartbeat-top-widget',$jsi.premium_site_domain);}});}());